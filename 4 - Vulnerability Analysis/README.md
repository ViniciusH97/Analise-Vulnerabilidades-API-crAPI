# Análise de Vulnerabilidades

O objetivo desta fase é analisar a superfície de ataque das APIs que foram mapeadas na fase [Intelligence Gathering](https://github.com/ViniciusH97/Analise-Vulnerabilidades-API-crAPI/tree/main/2%20-%20Intelligence%20Gathering) para identificar e validar a existência de falhas de segurança.

O foco da análise será nas vulnerabilidades do OWASP API Security Top 10, com ênfase em falhas de Autenticação e Autorização.

## Ferramentas Principais

- **Burp Suite:** Interceptação por Proxy, repetição (Repeater) e automação (Intruder).

- **Postman:** Organização e envio de requisições-base.

- **Contas de Teste:**

        Usuário A: usuario1@gmail.com

        Usuario B: usuario2@gmail.com

## Análise de Vulnerabilidades de Endpoints:

Endpoints que envolve identidade de usuário (Broken Authentication)

Os endpoints abaixo pode ser usado por um atacante para se passar por outra pessoa ou quebrar o fluxo de login.

### Análise do endpoint: `POST /identity/api/auth/login`

Foi feito requisições com email e senha invalidos e foi possivel obter as seguintes respostas no endpoint `identity/api/auth/login`:

1. **E-mail correto e senha incorretos:** O endpoint retorna a mensagem `Invalid Credentials`.
2. **E-mail e senha incorreta:** O endpoint retorna a mensagem `Given a E-mail is not registered`.

Após a análise foi possível identificar respostas diferentes para cada caso. Quando o e-mail é válido e a senha é inválide, e quanto do e-mail e senha são invalidos. O retorno de credenciais inválidas e que o e-mail não está cadastrado facilita ao atacante realizar uma enumeração de usuários, ou seja, pode aplicar um ataque dicionário, esperando as resposta das requisições `Invalid Credentials`, fornecendo a informação que o e-mail está cadastrado mas a senha não é válida, caso contrário, se retornar `Given a E-mail not registered` significa que o e-mail não está cadastrado no banco de dados.

O ultimo caso é o teste com e-mail e senha válidos, nesse casos é retornado o token no próprio `response` após a requisição da API. Ao coletar o token, o próximo passo foi analisar o token de autenticação na ferramenta [jwt.io](https://www.jwt.io/), com ele foi possível visualizar o Header e o Payload, como podemos ver na imagem abaixo:

[imagem]

Segundo a imagem podemos ver que o campo `"alg": "RS256"`, ele indica que o token é assinado usando o algoritmo RS256. Este é um algoritmo de criptografia assimétrica, o que significa que foi usada uma chave privada para assinar o token e uma chave pública correspondente é necessária para verificar a assinatura.

O outro campo é do payload:

- `"sub": "usuario1@gmail.com"`: O "subject" (assunto) do token, que identifica o usuário como "usuario1@gmail.com". 
- `"iat": 1761328882`: O "issued at" (emitido em), um carimbo de data/hora (timestamp) de quando o token foi criado.
- `"exp": 1761933682`: O "expiration" (expiração), o timestamp de quando o token deixará de ser válido.
- `"role": "user":` Um campo personalizado (claim) que define o nível de permissão do usuário como "user".

Esse token está normal. A "assinatura inválida" é esperada no jwt.io sem a chave pública. A segurança real depende de o servidor validar corretamente a assinatura, o alg e a data de expiração (exp).

### Análise do endpoint: `POST /identity/api/v2/user/reset-password`

Este endpoint é responsável por validar o token OTP (One-Time Password) enviado ao usuário para permitir a redefinição de senha.

Foi identificado que o endpoint não possui um mecanismo de rate limiting (limite de tentativas) ou de bloqueio após múltiplas falhas. Isso o torna vulnerável a um ataque de força bruta no campo otp, permitindo que um atacante adivinhe o código e redefina a senha de outra conta (neste caso, a do usuario2@gmail.com).

### Análises do endpoint: `POST /identity/api/auth/signup`

